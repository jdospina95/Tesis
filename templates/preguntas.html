<!DOCTYPE HTML>
<html>
    <head>
    	<title>Herramienta Instituto</title>
    	<meta charset="utf-8" />
    	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    	<link rel="icon" href="http://www.ciegosysordos.org.co/wp/wp-content/uploads/2018/01/cropped-favicon_instituto_ciegos_sordos_valle_cauca-1-32x32.png" sizes="32x32" />
      	<link rel="icon" href="http://www.ciegosysordos.org.co/wp/wp-content/uploads/2018/01/cropped-favicon_instituto_ciegos_sordos_valle_cauca-1-192x192.png" sizes="192x192" />
      	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      	<script src="http://code.responsivevoice.org/responsivevoice.js"></script>
      	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    </head>
    <body>
        <div class="container" style="page-break-inside: avoid; height: 100%; width: 100%;">
          <div class="row">
            <div class="col-sm-6">
                <div class="row">
                  <h4 id="pregunta"></h4>
                </div>
                <div class="row">
                  <input type="text" id="respuesta" style="max-width: 60%;" autofocus></input>
                </div>
            </div>
            <div class="col-sm-6">
              <object id="imagen" type="image/svg+xml" style="height: auto; width: 100%;"></object>
            </div>
          </div>
        </div>
        
        <!--<div><a href="https://responsivevoice.org">ResponsiveVoice-NonCommercial</a> licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><img title="ResponsiveVoice Text To Speech" src="https://responsivevoice.org/wp-content/uploads/2014/08/95x15.png" alt="95x15" width="95" height="15" /></div>-->
        
        <script>
        
            function redireccionarMenuInicio() {
                $.post( "/GuardarResultados", { 
                    actividad: "Actividad 1",
                    preguntas: JSON.stringify(listaPreguntas), 
                    respuestas: JSON.stringify(respuestasUsuario),
                    respuestasCorrectas: JSON.stringify(listaRespuestasCorrectas),
                    aciertos: aciertos
                } );
                window.location = "/MenuInicio";
            }
            
            function validarRespuesta(respuestaUsuario, respuestaCorrecta, numeros){
                var validacion = false;
                respuestaUsuario = estandarizarRespuesta(respuestaUsuario);
                respuestaCorrecta = estandarizarRespuesta(numeros[respuestaCorrecta].texto);
                if(respuestaCorrecta == respuestaUsuario){
                    validacion = true;
                }
                return validacion;
            }
            
            function estandarizarRespuesta(texto){
                texto = texto.replace(/\s+/g,'');
                texto.toLowerCase();
                return texto;
            }
        
        
            var cont = 0;
            var listaPreguntas = {{preguntas | safe}};
            var listaRespuestasCorrectas = {{respuestas | safe}};
            var listaImagenes = {{imagenes | safe}};
            var respuestasUsuario = [];
            var aciertos = 0;
            var numeros = JSON.parse('{{ numeros|safe }}');
            var down = true;
            
            $(document).keypress(function(e) {
                if(e.which == 13) {
                    if(down){
                        down = false
                        if(validarRespuesta(document.getElementById("respuesta").value, listaRespuestasCorrectas[cont], numeros)) {
                            document.getElementById("pregunta").innerHTML = "Correcto";
                            aciertos =+ 1;
                            responsiveVoice.speak("Correcto", "Spanish Latin American Female", {rate: 1.0});
                        } else {
                            document.getElementById("pregunta").innerHTML = "Incorrecto";
                            responsiveVoice.speak("Incorrecto", "Spanish Latin American Female", {rate: 1.0});
                        }
                        
                        if (listaPreguntas.length == respuestasUsuario.length+1) {
                            respuestasUsuario.push(document.getElementById("respuesta").value);
                            redireccionarMenuInicio();
                        } else {
                            setTimeout(function(){
                                cont ++;
                                
                                document.getElementById("pregunta").innerHTML = listaPreguntas[cont];
                                responsiveVoice.speak(listaPreguntas[cont], "Spanish Latin American Female", {rate: 1.0});
                                
                                var imagen = listaImagenes[cont];
                                document.getElementById("imagen").data = listaImagenes[cont]
                                
                                respuestasUsuario.push(document.getElementById("respuesta").value);
                                document.getElementById("respuesta").value = '';
                                
                                down = true;
                            
                            }, 3000);
                        }
                    }
                }
            });

            document.getElementById("pregunta").innerHTML = '{{ preguntas[0] }}';
            responsiveVoice.speak("'{{ preguntas[0] }}'", "Spanish Latin American Female", {rate: 1.0});
            
            document.getElementById("imagen").data = '{{ imagenes[0] }}';
            document.getElementById("imagen").addEventListener("load", function() {
                var doc = this.getSVGDocument();
                var rect = doc.getElementById("Capa_1");
                rect.setAttribute("fill", '{{ conf[1] }}');
                
                this.setAttribute("width", "auto");
            });
            
            var colorFondo = '{{ conf[0] }}';
            var colorFuente = '{{ conf[1] }}';
            var tamanoFuente = '{{ conf[2] }}';
            document.body.style.backgroundColor = colorFondo;
            document.getElementById("pregunta").style.color = colorFuente;
            document.getElementById("pregunta").style.fontSize = tamanoFuente;
            document.getElementById("respuesta").style.color = colorFuente;
            document.getElementById("respuesta").style.fontSize = tamanoFuente;
        </script>
        
    </body>
    
    <style>
		#header {
			padding: 2em 0 0.1em 0 !important;
		}
	</style>
    
        
    
</html>